---
title: "Data_Analysis_Project2"
author: "Parker Hicks"
date: "4/21/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if(!require(car)) install.packages("car")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(ggpubr)) install.packages("ggpubr")
if(!require(FSA)) install.packages("FSA")
if(!require(dplyr)) install.packages("dplyr")
if(!require(binom)) install.packages("binom")
if(!require(rcompanion)) install.packages("rcompanion")
if(!require(multcomp)) install.packages("multcomp")
if(!require(aod)) install.packages("aod")
if(!require(sandwich)) install.packages("sandwich")
if(!require(coin)){install.packages("coin")}
if(!require(agricolae)){install.packages("agricolae")}
if(!require(effects)){install.packages("effects")}


library(readr)
library(ggplot2)
library(binom)
library(dplyr)
library(FSA)
library(car)
library(rcompanion)
library(multcomp)
library(ggpubr)
library(aod)
library(sandwich)
library(coin)
library(agricolae)
```

# Data
```{r}
tit_data <- read.csv(("/Users/parkerhicks/Desktop/Biostats_data/tit_fitness_data.csv"), stringsAsFactors = TRUE)

tit_dataOmit <- na.omit(subset(tit_data, select=c("Weight", "wing", "broodSizeWhenSampled")))
#tit_dataOmit$broodSizeWhenSampled <- tit_dataOmit$broodSizeWhenSampled / 10
```

# Hypothesis

Null: 
There is no difference in the brood size of wild great tits on the basis of weight.
There is no difference in the brood size of wild great tits on the basis of wing size.
There is no difference in the brood size of wild great tits on the basis of weight and wing size

Alternative:
There is a difference in the brood size of wild great tits on the basis of weight.
There is a difference in the brood size of wild great tits on the basis of wing size.
There is a difference in the brood size of wild great tits on the basis of weight and wing size

# Linear Model
```{r}
tit_glm <- glm(broodSizeWhenSampled ~ Weight*wing, family="poisson", data = tit_dataOmit)
summary(tit_glm)
```

### Confidence Intervals
```{r}
cov.tit_glm <- vcovHC(tit_glm, type="HC0")
std.err <- sqrt(diag(cov.tit_glm))
r.est <- cbind(Estimate= coef(tit_glm), "SE" = std.err,
"Pr(>|z|)" = 2 * pnorm(abs(coef(tit_glm)/std.err), lower.tail=FALSE),
Lower_CI = coef(tit_glm) - 1.96 * std.err,
Upper_CI = coef(tit_glm) + 1.96 * std.err)

r.est
```


#Assumption Tests
```{r}
plot(tit_glm)
```

## Graph
```{r}
ggplot(tit_dataOmit, aes(x= broodSizeWhenSampled)) +
  geom_histogram(binwidth = 1) +
  theme_minimal() +
  xlab("Great Tit Brood Size When Sampled") +
  ylab("Count") +
  ggtitle("Distribution of Brood Sizes Among Great Tits ")
```

## Permutation Independence Test
```{r}
independence_test(broodSizeWhenSampled ~ Weight*wing,
                  data = tit_dataOmit)
```

## Post hoc
```{r}
tit_dataOmit$broodSizeWhenSampled <- factor(tit_dataOmit$broodSizeWhenSampled, levels = c(1, 2, 3, 4, 5, 6))

log_model <- polr(broodSizeWhenSampled ~ Weight*wing , data = tit_dataOmit, Hess = TRUE)
summary(log_model)
```


## Confusion Matrix
```{r}
predictbrood = predict(log_model, tit_dataOmit)
table(tit_dataOmit$broodSizeWhenSampled, predictbrood)
mean(as.character(tit_dataOmit$broodSizeWhenSampled) != as.character(predictbrood))
```
The ordinal logistic model identifies low and high brood sizes poorly. This is because of inadequate representation of low and high brood sizes in the data. Shown in the histogram above.

```{r}
library("effects")
Effect(focal.predictors = "Weight",log_model)
plot(Effect(focal.predictors = "Weight",log_model), ticks=list(at=c(0.5)))
```


## Assumption Tests
```{r}
qqnorm(tit_dataOmit$wing)
qqline(tit_dataOmit$wing)

qqnorm(tit_dataOmit$Weight)
qqline(tit_dataOmit$Weight)

shapiro.test(tit_dataOmit$wing)
shapiro.test(tit_dataOmit$Weight)
```
The numerical data do not fit a normal distribution as the great tit wing and weights failed the Shapiro-Wilk test and are visibly different on the Q-Q plots. 







